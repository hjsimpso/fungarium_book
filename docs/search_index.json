[["index.html", "fungarium: Enabling the use of fungaria collections data for comprehensive trait analyses in R Preface", " fungarium: Enabling the use of fungaria collections data for comprehensive trait analyses in R Hunter J. Simpson 2022-01-11 Preface This book provides detailed guidance on how to use the R package fungarium for comprehensive analyses of ecological traits in fungi. These methods were first outlined by Simpson and Schilling (2021), who used fire-association as an example trait. To maintain consistency, fire-association is used as an example trait in this book as well. Note: Book is under active development, so please excuse any typos, missing details, or incomplete sections; however, if you would like to report any specific issues, please do so here: https://github.com/hjsimpso/fungarium_book/issues. If you would like to ask any questions about the content of this book, please do so here: https://github.com/hjsimpso/fungarium_book/discussions. If you have any specific issues with the fungarium package itself, please report them here: https://github.com/hjsimpso/fungarium/issues References "],["intro.html", "Chapter 1 Introduction 1.1 Motivation 1.2 Getting started", " Chapter 1 Introduction 1.1 Motivation Fungaria collections and citizen science observations (e.g.,iNaturalist, MushroomObserver) typically contain taxonomic, geographic, and temporal information for each fungal specimen. Additionally, these records also often contain trait-relevant metadata about the host, habitat, or substrate associated with the collected or observed specimens; thus, these records are well-suited for comprehensive investigations into taxonomic, geographic, and temporal patterns of ecological traits. The first step in pursuing these investigations is accessing data and generating a data set. Citizen science platforms and many fungaria have online interfaces for downloading data from their respective databases. This is useful if you are only interested in the specimen records from one particular database; however, if you are interested in maximizing the size of your data set and conducting broad analyses the best approach would be to combine data from all available databases. This is accomplished through online data aggregators like the Mycology Collections Portal (MyCoPortal) and Global Biodiversity Information Facility (GBIF). These online interfaces allows users to access occurrence data from a wide variety of fungaria and citizen science platforms and then automatically aggregate the data from these different sources into one data set. Before using occurrence data for trait analyses, a variety of preprocessing steps may be necessary. Occurrence data sets, especially those that are large and temporally and geographically diverse, often contain errors or inconsistencies. For example, taxon names may be outdated (e.g., taxon has been placed in new genus), date information may be nonsensical or have inconsistent format, location names may be misspelled, and GPS coordinates may be nonsensical or have inconsistent format. Additionally, the web interfaces where the data were obtained offer limited capabilities for selecting trait-relevant records; therefore, occurrence data also needs to be processed to identify records associated with the trait of interest. To overcome these various issues and help enable comprehensive trait analyses, we created the fungarium package, which contains a suite of functions for handling taxon, date, and location issues as well as enabling the identification of trait-associated records. To complement these preprocessing tools and further facilitate trait analyses, the fungarium package also contains functions for adding FunGuild data to each record, assigning records to hexagonal grid cells for bounding box geographical analyses, visualizing taxonomic patterns of trait data in annotated cladograms, and visualizing geographic patterns of trait data in annotated maps. Note that many of the fungarium preprocessing tools were created primarily for use with MyCoPortal data which is in verbatim format (i.e., unaltered from the format it was in, when received from the data provider). These functions can be used with GBIF data as well, but be aware that GBIF using its own processing tools to fix issues (i.e., interpretation) within each record. To circumvent GBIF processing and use fungarium processing tools on your data instead, use the verbatim data file within the Darwwin Core Archive downloaded from GBIF. This file should not contain GBIF interpretations. 1.2 Getting started 1.2.1 Installing fungarium install.packages(&quot;remotes&quot;) #install &#39;remotes&#39; (if not already installed) remotes::install_github(&quot;hjsimpso/fungarium@*release&quot;) #install the latest fungarium release 1.2.2 Retrieving MyCoPortal data Fungal collection/observation data can be retrieved from the MyCoPortal using mycoportal_tab within R or by manually downloading data from the MyCoPortal web interface at https://mycoportal.org. 1.2.2.1 mycoportal_tab mycoportal_tab removed from package as of v2.0.0. Function was too difficult to maintain due to the instability of the mycoportal.org webpage layout. If mycoportal.org ever implements a true API, this function may return. Mycoportal records can still be downloaded manually from mycoportal.org 1.2.2.2 MyCoPortal web interface MyCoPortal data sets can be downloaded using the web interface at https://mycoportal.org. Various query parameters (e.g., taxon, country, year, etc.) can be used to select records of interest. When selecting download preferences, uncheck Compressed ZIP file then select Darwin Core for Structure, Tab Delimited for File Format and UTF-8 (unicode) for Character Set. These file settings are necessary for data processing tools in the fungarium package to work properly. Downloaded data sets can be imported into R via read.delim or data.table::fread. 1.2.3 Retrieving GBIF data Fungal collection/observation data can be retrieved from GBIF using the web interface at https://www.gbif.org/. To take advance of fungarium processing tools, download your data sets in Darwin Core Archive format and use the verbatim data file within the archive. In some cases, you may also be able to retrieve records from within R using the rgbif package (see package details). "],["tax.html", "Chapter 2 Taxonomic analysis 2.1 Update taxon names and clean up 2.2 Calculating trait enrichment factors 2.3 Visualize trait enrichment factors", " Chapter 2 Taxonomic analysis 2.1 Update taxon names and clean up Some MyCoPortal records will have outdated or invalid taxonomy; therefore, all taxon names need to be either updated or confirmed using currently accepted taxonomic classification (e.g., GBIF backbone taxonomy) prior to trait analyses. In the example below, records not identified to the species level are removed from the data set. This helps avoid taxonomy uncertain issues, which are described in more detail by Simpson and Schilling (2021). After updating taxonomy, some records may now be classified outside of the taxonomic group that was originally queried. These records need to be removed if your analysis is to focus on the queried taxonomic group only. Example code for updating taxon names and cleaning up data set: library(fungarium) #import sample data set data(agaricales) #US agaricales records #see Table 2.1 for preview of agaricales data set Table 2.1: Preview of agaricales data set id institutionCode scientificName scientificNameAuthorship recordedBy year eventDate occurrenceRemarks habitat associatedTaxa country stateProvince county decimalLatitude decimalLongitude references 269864 9961160 O Galerina mniophila (Lasch) Kühner Gro Gulden 1997 1997-11-15 young Douglas fir forest United States Oregon Benton https://mycoportal.org/portal/collections/individual/index.php?occid=9961160 313673 454144 MICH Mycena galopus (Pers.) P. Kumm. A. H. Smith 1935 1935-11-30 USA California Humboldt 41.0595 -124.1419 https://mycoportal.org/portal/collections/individual/index.php?occid=454144 157092 4570238 iNaturalist Armillaria mellea (Vahl) P. Kumm. Cindy Trubovitz 2017 2017-01-07 &lt;p&gt;Growing from the base of an old log&lt;/p&gt;; &lt;a href=https://www.inaturalist.org/observations/5244247 target=_blank style=color: blue;&gt; Original observation #5244247 (iNaturalist)&lt;/a&gt; United States California 32.80975 -117.1295 https://mycoportal.org/portal/collections/individual/index.php?occid=4570238 281279 456630 MICH Hygrophorus olivaceoalbus (Fr.) Fr.  R. L. Shaffer 1956 1956-09-16 USA Idaho Valley 44.8753 -115.9017 https://mycoportal.org/portal/collections/individual/index.php?occid=456630 32558 2270252 MICH Cortinarius (Pers.) Gray S. J. Mazzer 1970 1970-05-31 [Collection is stored in Cortinarius indeterminate box] USA Michigan Cheboygan https://mycoportal.org/portal/collections/individual/index.php?occid=2270252 522392 345316 MICH Crepidotus malachius var. phragmocystidiosus Hesler &amp; A.H. Sm. A. H. Smith 1959 1959-08-18 Notes with collection North Amer. Sp. Crepidotus 1965 pg. 58. On hardwood USA Michigan Chippewa https://mycoportal.org/portal/collections/individual/index.php?occid=345316 234305 526338 OSC Cortinarius montanus Kauffman Jim Trappe 1976 1976-09-08 Old-growth Tsme Old-growth Tsme USA Oregon Lane https://mycoportal.org/portal/collections/individual/index.php?occid=526338 356189 2287069 DUKE Schizophyllum commune Fr.  D. Porter 1998 1998-04-00 United States Georgia Clarke 33.95 -83.383333 https://mycoportal.org/portal/collections/individual/index.php?occid=2287069 237907 2357852 WTU Cortinarius rubicundulus (Rea) A. Pearson L. L. Norvell, SAR. 1992 1992-11-17 Rotten wood/ duff. Sequoia, Tan Oak. U.S.A. California Mendocino https://mycoportal.org/portal/collections/individual/index.php?occid=2357852 140361 6920708 iNaturalist Amanita pachycolea D.E. Stuntz Taylor Bates 2017 2017-11-13 &lt;a href=https://www.inaturalist.org/observations/8797347 target=_blank style=color: blue;&gt; Original observation #8797347 (iNaturalist)&lt;/a&gt; United States Oregon 44.665631 -123.242596 https://mycoportal.org/portal/collections/individual/index.php?occid=6920708 #update names and classification data &lt;- taxon_update(agaricales, species_only=TRUE, show_status=FALSE) #remove records with taxon names that could not be updated or confirmed data2 &lt;- data[data$new_species!=&quot;&quot;,] #remove records no longer classified in agaricales data3 &lt;- data2[data2$new_order==&quot;Agaricales&quot;,] Note that taxon name updating and filtering was done prior to the taxonomic, geographic, and temporal analyses done by Simpson and Schilling (2021). This is not necessarily required for geographic and temporal analyses; however, you run the risk of including bad taxa (i.e. taxa that are not actually classified within your originally specified taxonomic group) in your analyses. Thus, it is recommended to update taxon names and filter before performing any downstream analyses. 2.2 Calculating trait enrichment factors To make quantitative trait comparisons between taxa, trait-relevant records are first identified using find_trait and then trait enrichment factors are calculated using enrichment. These enrichment factors correspond to the number of records associated with a certain trait divided by the number of total records for a given taxon. The following example investigates fire-association (i.e., association with fire-affected habitat, hosts, or substrates) as an ecological trait. Example code for finding trait records and calculating enrichment factors: #string for finding fire-associated records string1 &lt;- &quot;(?i)charred|burn(t|ed)|scorched|fire.?(killed|damaged|scarred)|killed.by.fire&quot; #string for removing records falsely identified as fire-associated string2 &lt;- &quot;(?i)un.?burn(t|ed)&quot; #filter out records that do not contain any environmental metadata (optional) #note that &quot;host&quot; is no longer present in new MyCoPortal data sets; see find_trait documentation data4 &lt;- data3[data3$occurrenceRemarks!=&quot;&quot;|data3$associatedTaxa!=&quot;&quot;| data3$habitat!=&quot;&quot;,] #find trait-relevant records trait_data &lt;- find_trait(data4, pos_string=string1, neg_string=string2) #get trait enrichment trait_enrichment &lt;- enrichment(all_rec=data, trait_rec=trait_data, coll_bias=TRUE, status_feed=FALSE) #filter taxa based on collector bias (optional) trait_enrichment &lt;- trait_enrichment[trait_enrichment$max_bias&lt;=0.75,] #filter taxa based on total number of records (optional) trait_enrichment &lt;- trait_enrichment[trait_enrichment$freq&gt;=5,] Note that there are various optional filtering steps that may be done before and after trait searching and enrichment factor calculation, all of which have the potential to improve the accuracy of enrichment values. In the example above, records that did not contain any environmental metadata were removed prior to trait searching. This helps remove potential false negative records (i.e., records that are in fact associated with the trait of interest but are not identified as such), which negatively impact the enrichment factor accuracy. After trait searching and enrichment factor calculation, there a variety of output fields that can be used for data set filtering. The freq or trait_freq output fields correspond to the number of total records and the number of trait-relevant records, respectively, for each unique taxon. These can both be used to filter out taxa that have not been sampled thoroughly enough to calculate trustworthy enrichment values (enrichment values are listed under the trait_ratio output field; see enrichment documentation for more details about output fields). For example, a taxon with 50 total records will have a more trustworthy enrichment value than a taxon that has only 5 total records. The max_bias or coll_groups output fields correspond to the maximum proportion of records collected by one group of associated collectors and the total number of associated collector groups, respectively. These fields can be used to filter out taxa that have been collected with a high degree of bias, and, thus, may not have trustworthy enrichment values. For example, a taxon with a max_bias value of 0.25 will likely have a more trustworthy enrichment value than a taxon with a value of 0.85. See Simpson and Schilling (2021) for more details about how enrichment values can be negatively impacted by collector bias. 2.3 Visualize trait enrichment factors After trait enrichment factors have been calculated for each species, these values can been visualized within a cladogram using trait_clado. This function generates a cladogram based on the taxonomic classification of each species (up-to-date taxonomic classification is given in the output of taxon_update). Cladogram tip color corresponds to the enrichment value of each species, whereas node color corresponds to the enrichment value of each higher-level taxon in the cladogram. Other tree annotation options are available. See trait_clado documentation for more details. Example code for making rectangular trait cladogram: #load sample enrichment data set for global Agaricales records data(agaricales_enrich) #see Table 2.2 for preview of Agaricales enrichment data set Table 2.2: Preview of Agaricales enrichment data set new_full_name freq trait_freq trait_ratio coll_blanks blanks_bias coll_blanks_t blanks_bias_t max_bias coll_groups max_bias_t coll_groups_t new_kingdom new_phylum new_class new_order new_family new_genus new_species 1626 Tricholoma colossus (Fr.) Quél. 2 0 0 0 0 0 0 0.5000000 2 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Tricholomataceae Tricholoma Tricholoma colossus 555 Harmajaea harperi (Murrill) Dima &amp; P.Alvarado 1 0 0 0 0 0 0 1.0000000 1 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Pseudoclitocybaceae Harmajaea Harmajaea harperi 2135 Coprinopsis acuminata (Romagn.) Redhead, Vilgalys &amp; Moncalvo 5 0 0 0 0 0 0 0.4000000 4 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Psathyrellaceae Coprinopsis Coprinopsis acuminata 2478 Coprinopsis cinerea (Schaeff.) Redhead, Vilgalys &amp; Moncalvo 9 0 0 0 0 0 0 0.1111111 9 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Psathyrellaceae Coprinopsis Coprinopsis cinerea 2342 Amanita agglutinata (Berk. &amp; M.A.Curtis) Lloyd 7 0 0 0 0 0 0 0.2857143 6 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Amanitaceae Amanita Amanita agglutinata 885 Mycena subrubridisca (Murrill) Murrill 1 0 0 0 0 0 0 1.0000000 1 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Mycenaceae Mycena Mycena subrubridisca 2281 Cortinarius porphyropus (Alb. &amp; Schwein.) Fr.  6 0 0 0 0 0 0 0.3333333 5 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Cortinariaceae Cortinarius Cortinarius porphyropus 540 Gymnopus dentatus Murrill 1 0 0 0 0 0 0 1.0000000 1 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Omphalotaceae Gymnopus Gymnopus dentatus 2450 Melanoleuca dryophila Murrill 8 0 0 0 0 0 0 0.1250000 8 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Tricholomataceae Melanoleuca Melanoleuca dryophila 1013 Psathyrella incondita A.H.Sm. 1 0 0 0 0 0 0 1.0000000 1 0 0 Fungi Basidiomycota Agaricomycetes Agaricales Psathyrellaceae Psathyrella Psathyrella incondita #filter out taxa with high collector bias (optional) agaricales_enrich &lt;- agaricales_enrich[agaricales_enrich$max_bias&lt;=0.75,] agaricales_enrich &lt;- agaricales_enrich[agaricales_enrich$max_bias_t&lt;=0.75,] #filter out taxa with low total records (&quot;freq&quot;) agaricales_enrich &lt;- agaricales_enrich[agaricales_enrich$freq&gt;=3,] #make cladogram library(ggtree) library(ggplot2) trait_clado(data=agaricales_enrich, continuous=&quot;color&quot;, ladderize=TRUE, layout=&quot;rectangular&quot;, size=1.2, formula = ~new_order/new_family/new_genus/new_species, filter=&quot;high-100-trait_ratio&quot;, node_all = TRUE)+ geom_tiplab(color = &quot;black&quot;, hjust = 0, offset = 0.1, size = 2.6, fontface = &quot;italic&quot;) + #add species labels geom_tippoint(shape=20, aes(color=trait_ratio, size=trait_freq), alpha=0.75)+#add tree tips scale_color_gradientn(colours= c(&quot;cyan&quot;, &quot;blue&quot;, &quot;purple&quot;, &quot;red&quot;, &quot;orange&quot;), name = &quot;Fire-associated records enrichment&quot;, limits = c(0, round(max(agaricales_enrich$trait_ratio),2)), guide = guide_colourbar(label.vjust = 0.6, label.theme = element_text(size = 10, colour = &quot;black&quot;, angle = 0), title.position = &quot;top&quot;, nbin=100, draw.ulim = FALSE, draw.llim = FALSE, barwidth = 15, barheight = 0.5))+ scale_size(name = &quot;Fire-associated records&quot;, guide = guide_legend(keywidth = 2, keyheight = 1, label.position = &quot;bottom&quot;, label.vjust = 0.6, label.theme = element_text(size = 10, colour = &quot;black&quot;, angle = 0), title.position = &quot;top&quot;)) + theme(plot.margin=margin(0,0,0,0), legend.title = element_text(size = 10, margin = margin(0,0,0,0)), legend.title.align = 0.5, legend.position = &quot;bottom&quot;, legend.justification = &quot;center&quot;, legend.margin = margin(0,0,0,0), plot.title = element_text(hjust = 0.5, margin=margin(0,0,0,0)))+ xlim(c(0,5)) Figure 2.1: Cladogram showing fire-association enrichment for top 100 Agaricales species with the highest enrichment Example code for making circular trait cladogram: #load sample enrichment data set data(agaricales_enrich) #filter out taxa with high collector bias (optional) agaricales_enrich &lt;- agaricales_enrich[agaricales_enrich$max_bias&lt;=0.75,] agaricales_enrich &lt;- agaricales_enrich[agaricales_enrich$max_bias_t&lt;=0.75,] #filter out taxa with low total records (&quot;freq&quot;) agaricales_enrich &lt;- agaricales_enrich[agaricales_enrich$freq&gt;=3,] #make cladogram library(ggtree) library(ggplot2) trait_clado(data=agaricales_enrich, continuous=&quot;color&quot;, ladderize=TRUE, layout=&quot;circular&quot;, size=0.8, formula = ~new_order/new_family/new_genus/new_species, filter=&quot;high-300-trait_ratio&quot;, node_all = TRUE)+ geom_tiplab2(color = &quot;black&quot;, hjust = 0, offset = 0.1, size = 1, fontface = &quot;italic&quot;) + #add species labels geom_tippoint(shape=20, aes(color=trait_ratio, size=trait_freq), alpha=0.75)+#add tree tips scale_color_gradientn(colours= c(&quot;cyan&quot;, &quot;blue&quot;, &quot;purple&quot;, &quot;red&quot;, &quot;orange&quot;), name = &quot;Fire-associated records enrichment&quot;, limits = c(0, round(max(agaricales_enrich$trait_ratio),2)), guide = guide_colourbar(label.vjust = 0.6, label.theme = element_text(size = 10, colour = &quot;black&quot;, angle = 0), title.position = &quot;top&quot;, nbin=100, draw.ulim = FALSE, draw.llim = FALSE, barwidth = 15, barheight = 0.5))+ scale_size(name = &quot;Fire-associated records&quot;, guide = guide_legend(keywidth = 2, keyheight = 1, label.position = &quot;bottom&quot;, label.vjust = 0.6, label.theme = element_text(size = 10, colour = &quot;black&quot;, angle = 0), title.position = &quot;top&quot;)) + theme(plot.margin=margin(0,0,0,0), legend.title = element_text(size = 10, margin = margin(0,0,0,0)), legend.title.align = 0.5, legend.position = &quot;bottom&quot;, legend.justification = &quot;center&quot;, legend.margin = margin(0,0,0,0), plot.title = element_text(hjust = 0.5, margin=margin(0,0,0,0)))+ xlim(c(-1, 4)) Figure 2.2: Circle cladogram showing fire-association enrichment for the top 300 Agaricales species with the highest enrichment References "],["geo.html", "Chapter 3 Geographic analysis 3.1 Clean coordinates 3.2 Assigning records to geographic grid cells 3.3 Calculate trait enrichment per grid cell 3.4 Visualize trait enrichment", " Chapter 3 Geographic analysis Under construction 3.1 Clean coordinates Some occurrence records may have invalid coordinates (e.g., not in decimal format, not between -180 and 180 [lon] or -90 and 90 [lat], not within the bounds of the country listed) or coordinates with suspicious validity (e.g., zero/zero coordinates, lat and long are equal, coordinates match the country centroid), and these issues must be dealt with before conducting geographical analyses. coord_clean can be used to remove bad coordinates using a variety of validity tests (see function details). Additionally, the number of digits can be specified for automatic rounding of coordinates. Example code for cleaning coordinates: library(fungarium) #import sample data set data(agaricales_updated) #United States Agaricales records #see Table 2.1 for preview of agaricales data set Table 3.1: Preview of agaricales data set id institutionCode scientificName scientificNameAuthorship recordedBy year eventDate occurrenceRemarks habitat associatedTaxa country stateProvince county decimalLatitude decimalLongitude references 269864 9961160 O Galerina mniophila (Lasch) Kühner Gro Gulden 1997 1997-11-15 young Douglas fir forest United States Oregon Benton https://mycoportal.org/portal/collections/individual/index.php?occid=9961160 313673 454144 MICH Mycena galopus (Pers.) P. Kumm. A. H. Smith 1935 1935-11-30 USA California Humboldt 41.0595 -124.1419 https://mycoportal.org/portal/collections/individual/index.php?occid=454144 157092 4570238 iNaturalist Armillaria mellea (Vahl) P. Kumm. Cindy Trubovitz 2017 2017-01-07 &lt;p&gt;Growing from the base of an old log&lt;/p&gt;; &lt;a href=https://www.inaturalist.org/observations/5244247 target=_blank style=color: blue;&gt; Original observation #5244247 (iNaturalist)&lt;/a&gt; United States California 32.80975 -117.1295 https://mycoportal.org/portal/collections/individual/index.php?occid=4570238 281279 456630 MICH Hygrophorus olivaceoalbus (Fr.) Fr.  R. L. Shaffer 1956 1956-09-16 USA Idaho Valley 44.8753 -115.9017 https://mycoportal.org/portal/collections/individual/index.php?occid=456630 32558 2270252 MICH Cortinarius (Pers.) Gray S. J. Mazzer 1970 1970-05-31 [Collection is stored in Cortinarius indeterminate box] USA Michigan Cheboygan https://mycoportal.org/portal/collections/individual/index.php?occid=2270252 522392 345316 MICH Crepidotus malachius var. phragmocystidiosus Hesler &amp; A.H. Sm. A. H. Smith 1959 1959-08-18 Notes with collection North Amer. Sp. Crepidotus 1965 pg. 58. On hardwood USA Michigan Chippewa https://mycoportal.org/portal/collections/individual/index.php?occid=345316 234305 526338 OSC Cortinarius montanus Kauffman Jim Trappe 1976 1976-09-08 Old-growth Tsme Old-growth Tsme USA Oregon Lane https://mycoportal.org/portal/collections/individual/index.php?occid=526338 356189 2287069 DUKE Schizophyllum commune Fr.  D. Porter 1998 1998-04-00 United States Georgia Clarke 33.95 -83.383333 https://mycoportal.org/portal/collections/individual/index.php?occid=2287069 237907 2357852 WTU Cortinarius rubicundulus (Rea) A. Pearson L. L. Norvell, SAR. 1992 1992-11-17 Rotten wood/ duff. Sequoia, Tan Oak. U.S.A. California Mendocino https://mycoportal.org/portal/collections/individual/index.php?occid=2357852 140361 6920708 iNaturalist Amanita pachycolea D.E. Stuntz Taylor Bates 2017 2017-11-13 &lt;a href=https://www.inaturalist.org/observations/8797347 target=_blank style=color: blue;&gt; Original observation #8797347 (iNaturalist)&lt;/a&gt; United States Oregon 44.665631 -123.242596 https://mycoportal.org/portal/collections/individual/index.php?occid=6920708 #clean coordinates agaricales_cleaned &lt;- coord_clean(agaricales_updated) ## &#39;non-numeric coord&#39; test: 11788 records removed. ## &#39;non-valid coord&#39; test: 0 records removed. ## &#39;zero&#39; test: 0 records removed. ## &#39;equal&#39; test: 0 records removed. ## Running &#39;countries&#39; test... ## &#39;countries&#39; test: 392 records removed. ## Running &#39;centroids&#39; test... ## &#39;centroids&#39; test: 0 records removed. ## Total records removed: 12180 3.2 Assigning records to geographic grid cells Before plotting geographic trait data within bounding boxes, record coordinates are used to assign each record to individual grid cells. hex_grid can be used to create a world map grid of hexagonal cells with a specific area (in square kilometers). See the code below for a demonstration on how to assign occurrence records to individual grid cells. Example code for finding trait records and calculating enrichment factors: #make hex grid grid &lt;- hex_grid(20000) #convert lat/long points to sf geometry agaricales_sf &lt;- sf::st_as_sf(agaricales_cleaned, coords = c(&quot;decimalLongitude&quot;, &quot;decimalLatitude&quot;), crs = &quot;+proj=latlong +ellps=WGS84 +datum=WGS84&quot;) #convert to cylindrical equal area projection coordinates agaricales_sf &lt;- sf::st_transform(agaricales_sf, crs = &quot;+proj=cea +ellps=WGS84 +datum=WGS84&quot;) #assign points to grid cells agaricales_grid &lt;- sf::st_join(grid, agaricales_sf, join=sf::st_contains, left=FALSE) 3.3 Calculate trait enrichment per grid cell After assigning records to specific grid cells, trait enrichment can be calculated for each cell using the enrichment function. See code below for an example on calculating fire-associated enrichment. Example code for calculating enrichment factors: #find fire-associated records string1 &lt;- &quot;(?i)charred|burn(t|ed)|scorched|fire.?(killed|damaged|scarred)|killed.by.fire&quot; string2 &lt;- &quot;(?i)un.?burn(t|ed)&quot; trait_rec &lt;- find_trait(agaricales_grid, pos_string=string1, neg_string=string2) #find fire-associated enrichment per grid cell fire_enrich &lt;- enrichment(agaricales_grid, trait_rec, ext_var=&quot;geometry&quot;, by=&quot;hex&quot;) #filter out hex cells with low amount of occurrences fire_enrich &lt;- fire_enrich[fire_enrich$freq&gt;=5,] 3.4 Visualize trait enrichment Once enrichment values have been calculated, annotated grid cells can be plotted on a world map using trait_map. Additionally, world map can be cropped to a specific region, if desired. Example code for making trait map: #plot trait data on world map library(ggplot2) fire_enrich &lt;- sf::st_as_sf(fire_enrich) #convert enrichment table back to sf map &lt;- trait_map(fire_enrich, aes_mapping = aes(fill=trait_ratio), color=NA, alpha=0.95, size=0.1) map Figure 3.1: World map showing fire-associated enrichment via 20,000km2 grid cells Example code for making trait map of specific region: #Because sample data in from US only, crop world map to focus on US region map+ ylim(c(300000,6000000))+ xlim(c(-18000000,-6000000)) Figure 3.2: United States map showing fire-associated enrichment via 20,000km2 grid cells "],["tem.html", "Chapter 4 Temporal analysis", " Chapter 4 Temporal analysis Under construction "],["conc.html", "Chapter 5 Final Words", " Chapter 5 Final Words Under construction "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
